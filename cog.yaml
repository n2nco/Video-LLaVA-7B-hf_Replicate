build:
  gpu: true
  python_version: "3.10"
  python_packages:
    - "torch>=2.0.0"
    - "torchvision"
    - "torchaudio"
    - "transformers==4.46.0"
    - "huggingface-hub==0.23.4"
    - "av==12.2.0"
    - "accelerate==0.31.0"
    - "pillow==10.4.0"
    - "sentencepiece==0.2.0"
    - "protobuf==5.27.2"
    - "numpy==1.26.4"
    - "bitsandbytes>=0.41.1"
  system_packages:
    - "ffmpeg"
    - "rsync"
  run:
    - pip install --pre torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/nightly/cpu
    - mkdir -p /src/model_cache
    - chmod -R 777 /src  # Added this line to fix permissions
    # Debug commands to see what's available
    - echo "=== Current directory contents ==="
    - ls -la
    - echo "=== /src/app contents ==="
    - ls -la /src/app || echo "No /src/app directory"
    # Try first location
    - test -d "/src/app/model_cache" && cp -rv /src/app/model_cache/* /src/model_cache/ || echo "Not found in /src/app"
    # Try second location
    - test -d "model_cache" && cp -rv model_cache/* /src/model_cache/ || echo "Not found in current dir"
    # Verify final state
    - ls -la /src/model_cache || echo "Failed to copy models"
    - echo "video-llava env is ready!"

predict: "predict.py:Predictor"
image: "r8.im/uncensored-com/video-llava-7b-hf"